// Copyright 2015 Aquatic Informatics Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
!function(){"use strict";var e={error:0,warning:1,info:2,debug:3,trace:4};angular.module("ai.public.logger",["ng"]).constant("AiLoggerLogLevels",e).provider("AiLogger",function(){var r,n=["ERROR","WARNING","INFO","DEBUG","TRACE"],t=["error","warn","info","debug","trace"],o=e.info,i=function(e){return e},a="%1$s  %2$-7s  %3$s - %4$s",g="unknownApp",u=function(){var e=new Date,r=e.toISOString().replace(/T/g," ");return r.replace(/Z/g," (UTC)")},s=function(r){if(angular.isString(r)){var t=_.find(n,function(e){return e===r.toUpperCase()});if(angular.isDefined(t))return e[t];throw new Error("Log level "+r+" is unknown")}if(_.isFinite(r)){if(r<e.error||r>e.trace)throw new Error("Cannot set log level: log level must be >= 0 and <= 4");return r}throw new Error("Cannot set log level: unknown log level type")},l=function(){function r(o){var i=this,a=o;this.getLogger=function(e){var n=String(e);return o.loggerName.length>0&&(n=o.loggerName+"."+n),new r(_.assign({},o,{loggerName:n}))},this.setLogLevel=function(e){a.logLevel=s(e)};var g=function(e){var r=_.rest(e);return a.stringFormatter.apply(null,_.map(r,a.translator))},u=function(r){if(!(a.logLevel<r)){var o=a.stringFormatter(a.messageFormat,a.timeStampGenerator(),n[r],a.loggerName,g(arguments)),i=r===e.trace?t[e.debug]:t[r];a.outputWritter[i](o)}};_.each(t,function(e,r){i[e]=_.bind(u,i,r)})}return r}();return{setAppName:function(e){g=String(e)},setTranslator:function(e){i=e},setStringFormatter:function(e){r=e},setLogLevel:function(e){o=s(e)},setTimeStampGenerator:function(e){u=e},setMessageFormat:function(e){a=e},$get:["$log","$window",function(e,n){return _.isUndefined(r)&&(r=n.s.sprintf),new l({loggerName:g,outputWritter:e,translator:i,stringFormatter:r,logLevel:o,timeStampGenerator:u,messageFormat:a})}]}})}();